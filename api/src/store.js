// src/store.js
import bcrypt from 'bcrypt';

// Estrutura de dados em mem√≥ria simulando um "banco de dados"
export const db = {
  // Armazena usu√°rios cadastrados
  users: new Map(),

  // Armazena refresh tokens emitidos
  refreshTokens: new Map(),

  // ‚úÖ GARANTA QUE ESTA LINHA EXISTA ‚úÖ
  posts: new Map(), // Armazena posts (id, title, content, ownerId)
};

// üîπ SEED (pr√©-popula√ß√£o do "banco" com usu√°rios de exemplo)
(async () => {
  /**
   * Fun√ß√£o auxiliar para criar usu√°rio
   */
  const mkUser = async (id, email, password, roles = ['user']) => {
    const passwordHash = await bcrypt.hash(password, 10);
    db.users.set(id, { id, email, passwordHash, roles });
  };

  // Cria usu√°rio administrador com roles ['admin', 'user']
  await mkUser('u1', 'admin@example.com', 'admin123', ['admin', 'user']);

  // Cria usu√°rio comum apenas com role ['user']
  await mkUser('u2', 'user@example.com', 'user123', ['user']);

  // Popula com posts de exemplo
  db.posts.set('p1', { id: 'p1', title: 'Post do Admin', content: 'Este √© o conte√∫do.', ownerId: 'u1' });
  db.posts.set('p2', { id: 'p2', title: 'Post do Usu√°rio', content: 'Conte√∫do do post.', ownerId: 'u2' });
})();